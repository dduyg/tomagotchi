<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCD Orb Music Visualizer</title>
<style>
  body {
    margin: 0;
    background: radial-gradient(circle at center, #0a0a0a, #111122);
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: Arial, sans-serif;
  }

  #centralOrb {
    position: absolute;
    width: 150px;
    height: 150px;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
  }

  .orb {
    position: absolute;
    width: 40px;
    height: 40px;
    transform: translate(-50%, -50%);
    pointer-events: none;
  }

  input[type=file] {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 10;
  }
</style>
</head>
<body>

<input type="file" id="audioInput" accept="audio/*">
<img src="scd-ball.svg" id="centralOrb" alt="Central Orb">

<script>
const centralOrb = document.getElementById('centralOrb');
const audioInput = document.getElementById('audioInput');

let audioCtx, source, analyser;
let dataArray, bufferLength;

const orbitOrbs = [];

// Create orbiting orbs
for(let i=0;i<12;i++){
  const orb = document.createElement('img');
  orb.src = 'scd-ball.svg';
  orb.className = 'orb';
  document.body.appendChild(orb);
  orbitOrbs.push({ element: orb, angle: i * (Math.PI*2/12), radius: 200 });
}

// Audio setup
audioInput.addEventListener('change', function(){
  const file = this.files[0];
  if(!file) return;
  const audio = new Audio(URL.createObjectURL(file));
  audio.loop = true;
  audio.play();

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  source = audioCtx.createMediaElementSource(audio);
  analyser = audioCtx.createAnalyser();
  source.connect(analyser);
  analyser.connect(audioCtx.destination);
  analyser.fftSize = 64;
  bufferLength = analyser.frequencyBinCount;
  dataArray = new Uint8Array(bufferLength);

  animate();
});

// Animate orbs
function animate(){
  requestAnimationFrame(animate);
  analyser.getByteFrequencyData(dataArray);

  // Pulse central orb based on average amplitude
  let sum = dataArray.reduce((a,b)=>a+b,0);
  let avg = sum / dataArray.length;
  let scale = 1 + avg/256;
  centralOrb.style.transform = `translate(-50%, -50%) scale(${scale})`;

  // Orbiting orbs
  orbitOrbs.forEach((o,i)=>{
    o.angle += 0.02;
    const amp = dataArray[i % dataArray.length] / 128;
    const radius = 150 + amp*100;
    const x = window.innerWidth/2 + radius * Math.cos(o.angle);
    const y = window.innerHeight/2 + radius * Math.sin(o.angle);
    o.element.style.left = x + 'px';
    o.element.style.top = y + 'px';
    o.element.style.transform = `translate(-50%, -50%) scale(${0.5 + amp})`;
  });
}
</script>

</body>
</html>
