<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orb Music Visualizer</title>

<style>
    body {
        margin: 0;
        background: #050510;
        overflow: hidden;
        font-family: Arial, sans-serif;
        color: #0ff;
    }
    #controls {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 10;
        background: rgba(0,0,0,0.5);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #0ff;
    }
    #controls input {
        width: 260px;
        padding: 6px;
        margin-bottom: 10px;
        font-size: 14px;
    }
    #controls button {
        padding: 8px 12px;
        background: #0ff;
        border: none;
        cursor: pointer;
        color: #000;
        font-weight: bold;
        margin-right: 5px;
    }
    #canvas {
        position: absolute;
        top: 0;
        left: 0;
    }
</style>
</head>

<body>

<div id="controls">
    <input id="urlInput" placeholder="Paste YouTube / Spotify URL">
    <button onclick="handleURL()">Load</button>
    <br>
    <input type="file" id="fileInput" accept="audio/*">
    <button onclick="playFile()">Play File</button>
</div>

<canvas id="canvas"></canvas>

<script>
let audio, audioCtx, analyser, dataArray;
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

let orbs = [];

function handleURL() {
    alert("For YouTube/Spotify: Browser cannot extract audio directly.\nUpload audio file OR use helper server.");
}

function playFile() {
    const fileInput = document.getElementById("fileInput");
    if (!fileInput.files.length) return alert("Pick an audio file.");

    if (audio) audio.pause();

    audio = new Audio(URL.createObjectURL(fileInput.files[0]));
    audio.crossOrigin = "anonymous";
    audio.play();

    setupAudio();
}

function setupAudio() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    let source = audioCtx.createMediaElementSource(audio);

    source.connect(analyser);
    analyser.connect(audioCtx.destination);

    analyser.fftSize = 256;
    let bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);

    animate();
}

class Orb {
    constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = 20;
        this.speed = 0.5 + Math.random() * 1.5;
        this.angle = Math.random() * Math.PI * 2;
    }

    update(force) {
        this.x += Math.cos(this.angle) * this.speed * (force/100);
        this.y += Math.sin(this.angle) * this.speed * (force/100);
        this.size = 20 + force/4;

        if (this.x < -100) this.x = canvas.width + 100;
        if (this.x > canvas.width + 100) this.x = -100;
        if (this.y < -100) this.y = canvas.height + 100;
        if (this.y > canvas.height + 100) this.y = -100;
    }

    draw() {
        let img = new Image();
        img.src = "scd-ball.svg";
        ctx.drawImage(img, this.x, this.y, this.size, this.size);
    }
}

for (let i=0; i<50; i++) orbs.push(new Orb());

function animate() {
    requestAnimationFrame(animate);

    ctx.clearRect(0,0,canvas.width,canvas.height);
    analyser.getByteFrequencyData(dataArray);

    let bass = dataArray[1];
    let mids = dataArray[64];
    let highs = dataArray[128];

    let force = bass * 0.8 + mids * 0.5 + highs * 0.3;

    orbs.forEach(o => {
        o.update(force);
        o.draw();
    });
}

window.onresize = () => {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
};
</script>

</body>
</html>
